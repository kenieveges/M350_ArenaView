# Программа управления системой технического зрения процесса селективного лазерного сплавления (MELTOR – Melting Observation and Review)

Этот репозиторий содержит систему на базе Python для мониторинга `.log` файлов 3D-принтера и захвата изображений с подключенной камеры при возникновении определенных событий.

<div style="text-align: center;">
    <img src="pics/camera.png" alt="Camera setup" width="756" height="392">
</div>

## Содержание
- [Реферат](#реферат)
- [Особенности](#особенности)
- [Требования](#требования)
- [Установка](#установка)
- [Настройка](#настройка)
- [Использование](#использование)
- [Структура каталогов](#структура-каталогов)
- [Вклад в проект](#вклад-в-проект)
- [Лицензия](#лицензия)

## Реферат

**Авторы:** Коробов Константин Сергеевич, Рипецкий Андрей Владимирович.  
**Правообладатель:** федеральное государственное бюджетное образовательное учреждение высшего образования «Московский авиационный институт (национальный исследовательский университет)»

**Программа:** Программа управления системой технического зрения процесса селективного лазерного сплавления (MELTOR – Melting Observation and Review).

**Аннотация:**  
Программа управляет системой технического зрения для наблюдения и анализа процесса селективного лазерного сплавления в реальном времени. Она обрабатывает видеопоток с камеры, установленной над рабочей платформой, преобразует изображения и анализирует контуры для оценки отклонений между реальным слоем и контрольными данными трёхмерной модели изделия. Графический интерфейс объединяет описанные функции, позволяя контролировать процесс и фиксировать отклонения. Программа полезна для мониторинга качества и контроля стабильности аддитивного производства металлических деталей.


## Особенности

- **Мониторинг в реальном времени:** Мониторинг файла журнала 3D-принтера в режиме реального времени на предмет определенных событий.
- **Захват изображений:** Захват и сохранение изображений в базу данных с подключенной камеры при обнаружении событий насыпки и сплавление порошкового слоя.
- **Конфигурация:** Использование файла конфигурации в формате TOML для конфигурации системы мониторинга.
- **Обработка ошибок:** Комплексная обработка ошибок для управления проблемами с конфигурацией, подключением камеры и непредвиденными ошибками.
- **Ведение журнала:** Подробное логгирование событий для отслеживания поведения системы и облегчения отладки.
- **Управление ресурсами:** Очистка ресурсов с целью предотвращения утечек памяти и других проблем, связанных с ресурсами.

## Требования

- Python 3.8 или выше
- Библиотека `arena_api` для управления камерой
- Библиотека `watchdog` для мониторинга файлов
- Библиотека `tomllib` для парсинга файла конфигурации
- Подключаемая камера, совместимая с системой

## Установка

1. **Клонирование репозитория:**

   ```bash
   git clone https://github.com/your-username/slm-printer-monitoring.git
   cd slm-printer-monitoring
   ```

2. **Установка зависимостей:**

   ```bash
   pip install -r requirements.txt
   ```

3. **Настройка камеры:**
   - Убедитесь, что ваша камера подключена и правильно настроена.
   - Установите необходимые драйверы и программное обеспечение для вашей камеры.

4. **Настройка файла журнала:**
   - Убедитесь, что файл журнала 3D-принтера доступен для чтения системой.

## Настройка

Система использует файл конфигурации в формате TOML с именем `config.toml` по умолчанию. Вы можете настроить конфигурацию, создав или изменив этот файл в корневом каталоге проекта.

### Пример `config.toml`:

```toml
[log]
path = "/путь/к/файлу/журнала/принтера.log"

[camera]
retry_attempts = 6
retry_delay = 10

[capture]
delay = 5.0

[save]
root = "/путь/для/хранения/изображений"
part_name = "пример_детали"
project_name = "пример_проекта"
```

### Параметры конфигурации:

- **log.path:** Путь к файлу журнала 3D-принтера.
- **camera.retry_attempts:** Количество попыток инициализации камеры.
- **camera.retry_delay:** Задержка между попытками инициализации камеры (в секундах).
- **capture.delay:** Задержка между захватами изображений (в секундах).
- **save.root:** Корневой каталог для сохранения захваченных изображений.
- **save.part_name:** Название детали, которая печатается.
- **save.project_name:** Название проекта для префиксов файлов изображений.

## Использование

1. **Запуск приложения:**

   ```bash
   python main.py
   ```

2. **Использование пользовательской конфигурации:**
   - Вы можете указать пользовательский файл конфигурации с помощью флага `--config`:

     ```bash
     python main.py --config пользовательская_конфигурация.toml
     ```

3. **Мониторинг:**
   - Система начнет мониторинг указанного файла журнала и захватывать изображения при обнаружении событий насыпки порошка.
   - Изображения будут сохранены в указанный каталог с соответствующими именами файлов.

## Структура каталогов

```
slm-printer-monitoring/
├── camera_controller.py
├── config_loader.py
├── file_monitor.py
├── log_monitor.py
├── logger.py
├── main.py
├── requirements.txt
├── config.toml
└── README.md
```

- `camera_controller.py`: Управление операциями камеры.
- `config_loader.py`: Загрузка конфигурации из файла TOML.
- `file_monitor.py`: Мониторинг файлов журнала на изменения.
- `log_monitor.py`: Мониторинг файла журнала 3D-принтера на предмет определенных событий.
- `logger.py`: Настройка системы ведения журнала.
- `main.py`: Основной входной пункт приложения.
- `requirements.txt`: Список зависимостей Python.
- `config.toml`: Файл конфигурации по умолчанию.
- `README.md`: Этот файл.

## Вклад в проект

Вклад приветствуется! Пожалуйста, следуйте этим рекомендациям:

1. Сделайте форк репозитория.
2. Создайте новую ветку для вашей функции или исправления.
3. Сделайте коммиты и отправьте их в свой форк.
4. Отправьте запрос на включение изменений, подробно описав их.

## Лицензия

Этот проект получил свидетельство о регистрации программы для ЭВМ и лицензирован по лицензии Educational Community License (ECL) v2.0. Подробности см. в файле [LICENSE](LICENSE).

<div style="text-align: center;">
    <img src="pics/certificate.png" alt="Camera setup" width="240" height="343">
</div>